!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function r(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"___this",{get:function(){return this},configurable:!0}),___this.globalThis=___this;const t=___this;return delete Object.prototype.___this,t}n.r(e);const o=r(),s=o.Symbol||{},i=(t,e)=>t in e,a={},c=t=>t&&!!t[s.iterator],u=a.constructor,f=a.hasOwnProperty;"undefined"!=typeof window&&(window.navigator&&!!window.navigator.userAgent||window.document&&document.createElement),"undefined"!=typeof self&&!!self.postMessage&&o.importScripts,"function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout;var l="assign"in u?u.assign:function(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)f.call(n,e)&&(t[e]=n[e])}return t};let p=r();i("Map",p);const y=i("Set",p),h=(i("WeakMap",p)&&i("WeakSet",p),"__@@set"),d=t=>t!=t,b=(t,e)=>t===e||d(t)&&d(e),m=t=>0===t?0:t;let g,_,w;if("undefined"!=typeof Symbol){function A(t,e){const n=t[h];let r=0;const o=n.length;return{[Symbol.iterator]:function(){return this},next:function(){if(r<o){const t=n[r++];return{value:e?[t,t]:t,done:!1}}return{value:void 0,done:!0}}}}g=function(){return A(this,!0)},_=function(){return A(this,!1)},w=function(){return A(this,!1)}}else g=w=_=function(){console.warn("no symbol support")};var S={keys:w,values:_,entries:g};function T(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}const E=function t(e,n){if(!n&&y)return new Set(e);T(this,t),this[h]=[],function(t,e){if(null!=e){if(!c(e))throw new Error("value:"+String(e)+" is not iterable");for(const n of e)t.add(n)}}(this,e)};var v;(v=E).prototype.add=function(t){return this.has(t)||this[h].push(m(t)),this},v.prototype.has=function(t){for(const e of this[h])if(b(e,t))return!0;return!1},v.prototype.delete=function(t){let e=!1;return this[h]=this[h].filter(n=>{const r=!b(n,t);return r||(e=!0),r}),e},v.prototype.forEach=function(t,e){for(const n of this[h]){const r=n,o=this;e?t.call(e,r,r,o):t(r,r,o)}},v.prototype.clear=function(){this[h].length=0},Object.defineProperty(v.prototype,"size",{enumerable:!1,configurable:!0,get:function(){return this[h].length}}),"undefined"!=typeof Symbol&&(v.prototype[Symbol.iterator]=S.values,v.prototype[Symbol.toStringTag]="Set"),l(v.prototype,S),E[Symbol.species]=E;var M=E;class R{_onMessage(t){const{data:e}=t;console.log(e),this._emitSubscription(e)}_emitSubscription(t){this._subscriptions.forEach(e=>e(t))}subscribe(t){if("function"!=typeof t)throw new Error("not a function");this._subscriptions.add(t)}subscribeType(t,e){const n=n=>n.type===t&&e(n);return this.subscribe(n),n}waitFor(t){return new Promise(e=>{let n;n=this.subscribeType(t,t=>{this.unsubscribe(n),e(t)})})}unsubscribe(t){this._subscriptions.delete(t)}sendType(t,e){return t={...t,type:e},console.log("sending=>",t),this.send(t)}transfer(t,e){this._worker.postMessage(t,e)}send(t){return this._worker.postMessage(t)}constructor(t){this._subscriptions=new M,this._worker=t||self,this._worker.addEventListener("message",this._onMessage.bind(this))}}const O={clear:"CLEAR",file:"FILE",error:"ERROR"},B=new TextEncoder,D=new TextDecoder,x=B.encode("<---META-DATA---\x3e"),P=x.buffer,j=P.byteLength,C=B.encode("<---META-DATA---\x3e".split().reverse().join()),k=t=>{const e=(t=String(t)).length;if(e>10)throw new Error("Invalid length");if(10==e)return t;for(;10!==t.length;)t=`0${t}`;return t};class L{static _encodeString(t){return B.encode(t)}static _getMetaDataBuffer(t){return new Promise(e=>{const n="string"==typeof t?B.encode(k(t.length)+t):t;return e(L.appendBuffers(n))})}static _getMetaFromBuffer(t){return new Promise(e=>{const n=t.slice(0,10),r=+D.decode(n).replace(/^0+/,"")+10;e({metaData:JSON.parse(D.decode(t.slice(10,r))),encryptedBuffer:t.slice(r)})})}onFile(t,e,n){}constructor(){this.methods={RSA:"RSA-OAEP",AES:"AES-GCM"}}init(){const t=new R(self);this.listener=t,t.subscribeType(O.file,t=>{const{file:e,method:n,key:r}=t;this.onFile(e,n,r)})}static appendBuffers(...t){const e=new Uint8Array(t.reduce((t,e)=>t+e.byteLength,0));let n=0;for(const r of t)e.set(r instanceof Uint8Array?r:new Uint8Array(r),n),n+=r.byteLength;return e.buffer}static arrayBufferToBase64(t){return new Promise((e,n)=>{const r=new Blob([t],{type:"application/octet-stream"}),o=new FileReader;o.onload=t=>{const n=t.target.result;e(n.substr(n.indexOf(",")+1))},o.readAsDataURL(r)})}static async base64ToArrayBuffer(t){const e=await fetch(`data:;base64,${t}`);return await e.arrayBuffer()}static textToChars(t){return t.split("").map(t=>t.charCodeAt(0))}static applySaltToChar(t,e){return L.textToChars(e).reduce((t,e)=>t^e,t)}static enc(t){const e=t=>`0${Number(t).toString(16)}`.substr(-2);return n=>n.split("").map(L.textToChars).map(e=>L.applySaltToChar(e,t)).map(e).join("")}static dec(t){return e=>e.match(/.{1,2}/g).map(t=>parseInt(t,16)).map(e=>L.applySaltToChar(e,t)).map(t=>String.fromCharCode(t)).join("")}}l(L,{RAW_META_STRING_LENGTH:524288,META_DATA_BOUNDARY:x,META_DATA_BOUNDARY_BUFF:P,META_DATA_LEN:j,META_DATA_BOUNDARY_REVERSE:C});var F="keys"in u?u.keys:function(t){const e=[];for(const n in t)f.call(t,n)&&e.push(n);return e},N="entries"in u?u.entries:function(t){const e=F(t);let n=e.length;const r=Array(n);for(;n--;){const o=e[n];r[n]=[o,t[o]]}return r};const U={};N({clear:"CLEAR",file:"FILE",error:"ERROR"}).map(([t,e])=>U[t]=`ack-${e}`);(new class extends L{_getKeyDict(t){if(t===this.methods.RSA)throw new Error("Not implemented yet");if(t===this.methods.AES)return{name:"AES-GCM",length:256}}async __encrypt(t,e,n){const r=await crypto.subtle.generateKey(this._getKeyDict(e),!0,["encrypt","decrypt"]);let o,s;const i={name:e},a={};if(e===this.methods.RSA){const t=r.publicKey;o=r.privateKey,s=t}else{o=s=r;const t=crypto.getRandomValues(new Uint8Array(50));i.iv=t;const e=await L.arrayBufferToBase64(t);a.iv=e}const c=await L.arrayBufferToBase64(await crypto.subtle.exportKey("raw",o));return a.key=L.enc(n)(c),{enc:await crypto.subtle.encrypt(i,s,t),metaData:a}}async onFile(t,e,n){const{enc:r,metaData:o}=await this.__encrypt(t,e,n),s=L.appendBuffers(await L._getMetaDataBuffer(JSON.stringify(o)),r);return this.listener.transfer({type:U.file,file:s},[t])}}).init()}]);
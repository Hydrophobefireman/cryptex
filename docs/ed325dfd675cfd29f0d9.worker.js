!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);const r=function(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"___this",{get:function(){return this},configurable:!0}),___this.globalThis=___this;const t=___this;return delete Object.prototype.___this,t}(),o=(r.Symbol,{}),s=o.constructor,i=o.hasOwnProperty;"undefined"!=typeof window&&(window.navigator&&!!window.navigator.userAgent||window.document&&document.createElement),"undefined"!=typeof self&&!!self.postMessage&&r.importScripts,"function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout;var a="assign"in s?s.assign:function(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)i.call(n,e)&&(t[e]=n[e])}return t};function c(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"___this",{get:function(){return this},configurable:!0}),___this.globalThis=___this;const t=___this;return delete Object.prototype.___this,t}const u=c(),f=u.Symbol||{},l=(t,e)=>t in e,p={},y=t=>t&&!!t[f.iterator],h=p.constructor,d=p.hasOwnProperty;"undefined"!=typeof window&&(window.navigator&&!!window.navigator.userAgent||window.document&&document.createElement),"undefined"!=typeof self&&!!self.postMessage&&u.importScripts,"function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout;let b=c();l("Map",b);const _=l("Set",b),g=(l("WeakMap",b)&&l("WeakSet",b),"__@@set"),m=t=>t!=t,w=(t,e)=>t===e||m(t)&&m(e),S=t=>0===t?0:t;let A,T,E;if("undefined"!=typeof Symbol){function v(t,e){const n=t[g];let r=0;const o=n.length;return{[Symbol.iterator]:function(){return this},next:function(){if(r<o){const t=n[r++];return{value:e?[t,t]:t,done:!1}}return{value:void 0,done:!0}}}}A=function(){return v(this,!0)},T=function(){return v(this,!1)},E=function(){return v(this,!1)}}else A=E=T=function(){console.warn("no symbol support")};var O={keys:E,values:T,entries:A},M="assign"in h?h.assign:function(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)d.call(n,e)&&(t[e]=n[e])}return t};function R(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}const P=function t(e,n){if(!n&&_)return new Set(e);R(this,t),this[g]=[],function(t,e){if(null!=e){if(!y(e))throw new Error("value:"+String(e)+" is not iterable");for(const n of e)t.add(n)}}(this,e)};var B;(B=P).prototype.add=function(t){return this.has(t)||this[g].push(S(t)),this},B.prototype.has=function(t){for(const e of this[g])if(w(e,t))return!0;return!1},B.prototype.delete=function(t){let e=!1;return this[g]=this[g].filter(n=>{const r=!w(n,t);return r||(e=!0),r}),e},B.prototype.forEach=function(t,e){for(const n of this[g]){const r=n,o=this;e?t.call(e,r,r,o):t(r,r,o)}},B.prototype.clear=function(){this[g].length=0},Object.defineProperty(B.prototype,"size",{enumerable:!1,configurable:!0,get:function(){return this[g].length}}),"undefined"!=typeof Symbol&&(B.prototype[Symbol.iterator]=O.values,B.prototype[Symbol.toStringTag]="Set"),M(B.prototype,O),P[Symbol.species]=P;var j=P;class D{_onMessage(t){const{data:e}=t;console.log(e),this._emitSubscription(e)}_emitSubscription(t){this._subscriptions.forEach(e=>e(t))}subscribe(t){if("function"!=typeof t)throw new Error("not a function");this._subscriptions.add(t)}subscribeType(t,e){const n=n=>n.type===t&&e(n);return this.subscribe(n),n}waitFor(t){return new Promise(e=>{let n;n=this.subscribeType(t,t=>{this.unsubscribe(n),e(t)})})}unsubscribe(t){this._subscriptions.delete(t)}sendType(t,e){return t={...t,type:e},console.log("sending=>",t),this.send(t)}transfer(t,e){this._worker.postMessage(t,e)}send(t){return this._worker.postMessage(t)}constructor(t){this._subscriptions=new j,this._worker=t||self,this._worker.addEventListener("message",this._onMessage.bind(this))}}const x={clear:"CLEAR",file:"FILE",error:"ERROR"},C=new TextEncoder,k=new TextDecoder,L=C.encode("<---META-DATA---\x3e"),F=L.buffer,N=F.byteLength,U=C.encode("<---META-DATA---\x3e".split().reverse().join()),I=t=>{const e=(t=String(t)).length;if(e>10)throw new Error("Invalid length");if(10==e)return t;for(;10!==t.length;)t=`0${t}`;return t};class K{static _encodeString(t){return C.encode(t)}static _getMetaDataBuffer(t){return new Promise(e=>{const n="string"==typeof t?C.encode(I(t.length)+t):t;return e(K.appendBuffers(n))})}static _getMetaFromBuffer(t){return new Promise(e=>{const n=t.slice(0,10),r=+k.decode(n).replace(/^0+/,"")+10;e({metaData:JSON.parse(k.decode(t.slice(10,r))),encryptedBuffer:t.slice(r)})})}onFile(t,e,n){}constructor(){this.methods={RSA:"RSA-OAEP",AES:"AES-GCM"}}init(){const t=new D(self);this.listener=t,t.subscribeType(x.file,t=>{const{file:e,method:n,key:r}=t;this.onFile(e,n,r)})}static appendBuffers(...t){const e=new Uint8Array(t.reduce((t,e)=>t+e.byteLength,0));let n=0;for(const r of t)e.set(r instanceof Uint8Array?r:new Uint8Array(r),n),n+=r.byteLength;return e.buffer}static arrayBufferToBase64(t){return new Promise((e,n)=>{const r=new Blob([t],{type:"application/octet-stream"}),o=new FileReader;o.onload=t=>{const n=t.target.result;e(n.substr(n.indexOf(",")+1))},o.readAsDataURL(r)})}static async base64ToArrayBuffer(t){const e=await fetch(`data:;base64,${t}`);return await e.arrayBuffer()}static textToChars(t){return t.split("").map(t=>t.charCodeAt(0))}static applySaltToChar(t,e){return K.textToChars(e).reduce((t,e)=>t^e,t)}static enc(t){const e=t=>`0${Number(t).toString(16)}`.substr(-2);return n=>n.split("").map(K.textToChars).map(e=>K.applySaltToChar(e,t)).map(e).join("")}static dec(t){return e=>e.match(/.{1,2}/g).map(t=>parseInt(t,16)).map(e=>K.applySaltToChar(e,t)).map(t=>String.fromCharCode(t)).join("")}}a(K,{RAW_META_STRING_LENGTH:524288,META_DATA_BOUNDARY:L,META_DATA_BOUNDARY_BUFF:F,META_DATA_LEN:N,META_DATA_BOUNDARY_REVERSE:U});var G="keys"in h?h.keys:function(t){const e=[];for(const n in t)d.call(t,n)&&e.push(n);return e},$="entries"in h?h.entries:function(t){const e=G(t);let n=e.length;const r=Array(n);for(;n--;){const o=e[n];r[n]=[o,t[o]]}return r};const W={};$({clear:"CLEAR",file:"FILE",error:"ERROR"}).map(([t,e])=>W[t]=`ack-${e}`);(new class extends K{_getKeyDict(t){if(t===this.methods.RSA)throw new Error("Not implemented yet");if(t===this.methods.AES)return{name:"AES-GCM",length:256}}async __encrypt(t,e,n){const r=await crypto.subtle.generateKey(this._getKeyDict(e),!0,["encrypt","decrypt"]);let o,s;const i={name:e},a={};if(e===this.methods.RSA){const t=r.publicKey;o=r.privateKey,s=t}else{o=s=r;const t=crypto.getRandomValues(new Uint8Array(50));i.iv=t;const e=await K.arrayBufferToBase64(t);a.iv=e}const c=await K.arrayBufferToBase64(await crypto.subtle.exportKey("raw",o));return a.key=K.enc(n)(c),{enc:await crypto.subtle.encrypt(i,s,t),metaData:a}}async onFile(t,e,n){const{enc:r,metaData:o}=await this.__encrypt(t,e,n),s=K.appendBuffers(await K._getMetaDataBuffer(JSON.stringify(o)),r);return this.listener.transfer({type:W.file,file:s},[t])}}).init()}]);
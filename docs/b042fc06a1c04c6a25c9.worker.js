!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"___this",{get:function(){return this},configurable:!0}),___this.globalThis=___this;const e=___this;return delete Object.prototype.___this,e}r.r(t);const o=n(),s=o.Symbol||{},i=(e,t)=>e in t,a={},c=e=>e&&!!e[s.iterator],u=a.constructor,f=a.hasOwnProperty;"undefined"!=typeof window&&(window.navigator&&!!window.navigator.userAgent||window.document&&document.createElement),"undefined"!=typeof self&&!!self.postMessage&&o.importScripts,"function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout;var l="assign"in u?u.assign:function(e){for(let t=1;t<arguments.length;t++){const r=arguments[t];for(const t in r)f.call(r,t)&&(e[t]=r[t])}return e};let p=n();i("Map",p);const y=i("Set",p),d=(i("WeakMap",p)&&i("WeakSet",p),"__@@set"),h=e=>e!=e,b=(e,t)=>e===t||h(e)&&h(t),_=e=>0===e?0:e;let g,m,w;if("undefined"!=typeof Symbol){function A(e,t){const r=e[d];let n=0;const o=r.length;return{[Symbol.iterator]:function(){return this},next:function(){if(n<o){const e=r[n++];return{value:t?[e,e]:e,done:!1}}return{value:void 0,done:!0}}}}g=function(){return A(this,!0)},m=function(){return A(this,!1)},w=function(){return A(this,!1)}}else g=w=m=function(){console.warn("no symbol support")};var T={keys:w,values:m,entries:g};function S(e,t){if(r=e,!(null!=(n=t)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](r):r instanceof n))throw new TypeError("Cannot call a class as a function");var r,n}const E=function e(t,r){if(!r&&y)return new Set(t);S(this,e),this[d]=[],function(e,t){if(null!=t){if(!c(t))throw new Error("value:"+String(t)+" is not iterable");for(const r of t)e.add(r)}}(this,t)};var v;(v=E).prototype.add=function(e){return this.has(e)||this[d].push(_(e)),this},v.prototype.has=function(e){for(const t of this[d])if(b(t,e))return!0;return!1},v.prototype.delete=function(e){let t=!1;return this[d]=this[d].filter(r=>{const n=!b(r,e);return n||(t=!0),n}),t},v.prototype.forEach=function(e,t){for(const r of this[d]){const n=r,o=this;t?e.call(t,n,n,o):e(n,n,o)}},v.prototype.clear=function(){this[d].length=0},Object.defineProperty(v.prototype,"size",{enumerable:!1,configurable:!0,get:function(){return this[d].length}}),"undefined"!=typeof Symbol&&(v.prototype[Symbol.iterator]=T.values,v.prototype[Symbol.toStringTag]="Set"),l(v.prototype,T),E[Symbol.species]=E;var M=E;class O{_onMessage(e){const{data:t}=e;console.log(t),this._emitSubscription(t)}_emitSubscription(e){this._subscriptions.forEach(t=>t(e))}subscribe(e){if("function"!=typeof e)throw new Error("not a function");this._subscriptions.add(e)}subscribeType(e,t){const r=r=>r.type===e&&t(r);return this.subscribe(r),r}waitFor(e){return new Promise(t=>{let r;r=this.subscribeType(e,e=>{this.unsubscribe(r),t(e)})})}unsubscribe(e){this._subscriptions.delete(e)}sendType(e,t){return e={...e,type:t},console.log("sending=>",e),this.send(e)}transfer(e,t){this._worker.postMessage(e,t)}send(e){return this._worker.postMessage(e)}constructor(e){this._subscriptions=new M,this._worker=e||self,this._worker.addEventListener("message",this._onMessage.bind(this))}}const R={clear:"CLEAR",file:"FILE",error:"ERROR"},B=new TextEncoder,D=new TextDecoder,P=B.encode("<---META-DATA---\x3e"),j=P.buffer,x=j.byteLength,C=B.encode("<---META-DATA---\x3e".split().reverse().join()),k=e=>{const t=(e=String(e)).length;if(t>10)throw new Error("Invalid length");if(10==t)return e;for(;10!==e.length;)e=`0${e}`;return e};class F{static _encodeString(e){return B.encode(e)}static _getMetaDataBuffer(e){return new Promise(t=>{const r="string"==typeof e?B.encode(k(e.length)+e):e;return t(F.appendBuffers(r))})}static _getMetaFromBuffer(e){return new Promise(t=>{const r=e.slice(0,10),n=+D.decode(r).replace(/^0+/,"")+10;t({metaData:JSON.parse(D.decode(e.slice(10,n))),encryptedBuffer:e.slice(n)})})}onFile(e,t,r){}constructor(){this.methods={RSA:"RSA-OAEP",AES:"AES-GCM"}}init(){const e=new O(self);this.listener=e,e.subscribeType(R.file,e=>{const{file:t,method:r,key:n}=e;this.onFile(t,r,n)})}static appendBuffers(...e){const t=new Uint8Array(e.reduce((e,t)=>e+t.byteLength,0));let r=0;for(const n of e)t.set(n instanceof Uint8Array?n:new Uint8Array(n),r),r+=n.byteLength;return t.buffer}static arrayBufferToBase64(e){return new Promise((t,r)=>{const n=new Blob([e],{type:"application/octet-stream"}),o=new FileReader;o.onload=e=>{const r=e.target.result;t(r.substr(r.indexOf(",")+1))},o.readAsDataURL(n)})}static async base64ToArrayBuffer(e){const t=await fetch(`data:;base64,${e}`);return await t.arrayBuffer()}static textToChars(e){return e.split("").map(e=>e.charCodeAt(0))}static applySaltToChar(e,t){return F.textToChars(t).reduce((e,t)=>e^t,e)}static enc(e){const t=e=>`0${Number(e).toString(16)}`.substr(-2);return r=>r.split("").map(F.textToChars).map(t=>F.applySaltToChar(t,e)).map(t).join("")}static dec(e){return t=>t.match(/.{1,2}/g).map(e=>parseInt(e,16)).map(t=>F.applySaltToChar(t,e)).map(e=>String.fromCharCode(e)).join("")}}l(F,{RAW_META_STRING_LENGTH:524288,META_DATA_BOUNDARY:P,META_DATA_BOUNDARY_BUFF:j,META_DATA_LEN:x,META_DATA_BOUNDARY_REVERSE:C});var L="keys"in u?u.keys:function(e){const t=[];for(const r in e)f.call(e,r)&&t.push(r);return t},N="entries"in u?u.entries:function(e){const t=L(e);let r=t.length;const n=Array(r);for(;r--;){const o=t[r];n[r]=[o,e[o]]}return n};const U={};N({clear:"CLEAR",file:"FILE",error:"ERROR"}).map(([e,t])=>U[e]=`ack-${t}`);(new class extends F{_getKeyDict(e,t){return{name:e,iv:t}}async __decrypt(e,t,r){const n=await F._getMetaFromBuffer(e),{iv:o,key:s}=n.metaData,{encryptedBuffer:i}=n,a=await F.base64ToArrayBuffer(o),c=await crypto.subtle.importKey("raw",await F.base64ToArrayBuffer(F.dec(r)(s)),t,!0,["encrypt","decrypt"]);return await crypto.subtle.decrypt(this._getKeyDict(t,a),c,i)}async onFile(e,t,r){try{const n=await this.__decrypt(e,t,r);return this.listener.transfer({type:U.file,file:n},[n])}catch(e){return console.log(e),this.listener.sendType({error:!0,message:e.message},U.error)}}}).init()}]);
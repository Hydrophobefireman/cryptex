!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const r=function(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"___this",{get:function(){return this},configurable:!0}),___this.globalThis=___this;const e=___this;return delete Object.prototype.___this,e}(),o=(r.Symbol,{}),s=o.constructor,i=o.hasOwnProperty;"undefined"!=typeof window&&(window.navigator&&!!window.navigator.userAgent||window.document&&document.createElement),"undefined"!=typeof self&&!!self.postMessage&&r.importScripts,"function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout;var a="assign"in s?s.assign:function(e){for(let t=1;t<arguments.length;t++){const n=arguments[t];for(const t in n)i.call(n,t)&&(e[t]=n[t])}return e};function c(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"___this",{get:function(){return this},configurable:!0}),___this.globalThis=___this;const e=___this;return delete Object.prototype.___this,e}const u=c(),f=u.Symbol||{},l=(e,t)=>e in t,p={},d=e=>e&&!!e[f.iterator],y=p.constructor,h=p.hasOwnProperty;"undefined"!=typeof window&&(window.navigator&&!!window.navigator.userAgent||window.document&&document.createElement),"undefined"!=typeof self&&!!self.postMessage&&u.importScripts,"function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout;let b=c();l("Map",b);const _=l("Set",b),g=(l("WeakMap",b)&&l("WeakSet",b),"__@@set"),m=e=>e!=e,w=(e,t)=>e===t||m(e)&&m(t),T=e=>0===e?0:e;let A,S,v;if("undefined"!=typeof Symbol){function E(e,t){const n=e[g];let r=0;const o=n.length;return{[Symbol.iterator]:function(){return this},next:function(){if(r<o){const e=n[r++];return{value:t?[e,e]:e,done:!1}}return{value:void 0,done:!0}}}}A=function(){return E(this,!0)},S=function(){return E(this,!1)},v=function(){return E(this,!1)}}else A=v=S=function(){console.warn("no symbol support")};var O={keys:v,values:S,entries:A},M="assign"in y?y.assign:function(e){for(let t=1;t<arguments.length;t++){const n=arguments[t];for(const t in n)h.call(n,t)&&(e[t]=n[t])}return e};function P(e,t){if(n=e,!(null!=(r=t)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}const j=function e(t,n){if(!n&&_)return new Set(t);P(this,e),this[g]=[],function(e,t){if(null!=t){if(!d(t))throw new Error("value:"+String(t)+" is not iterable");for(const n of t)e.add(n)}}(this,t)};var R;(R=j).prototype.add=function(e){return this.has(e)||this[g].push(T(e)),this},R.prototype.has=function(e){for(const t of this[g])if(w(t,e))return!0;return!1},R.prototype.delete=function(e){let t=!1;return this[g]=this[g].filter(n=>{const r=!w(n,e);return r||(t=!0),r}),t},R.prototype.forEach=function(e,t){for(const n of this[g]){const r=n,o=this;t?e.call(t,r,r,o):e(r,r,o)}},R.prototype.clear=function(){this[g].length=0},Object.defineProperty(R.prototype,"size",{enumerable:!1,configurable:!0,get:function(){return this[g].length}}),"undefined"!=typeof Symbol&&(R.prototype[Symbol.iterator]=O.values,R.prototype[Symbol.toStringTag]="Set"),M(R.prototype,O),j[Symbol.species]=j;var B=j;class D{_onMessage(e){const{data:t}=e;console.log(t),this._emitSubscription(t)}_emitSubscription(e){this._subscriptions.forEach(t=>t(e))}subscribe(e){if("function"!=typeof e)throw new Error("not a function");this._subscriptions.add(e)}subscribeType(e,t){const n=n=>n.type===e&&t(n);return this.subscribe(n),n}waitFor(e){return new Promise(t=>{let n;n=this.subscribeType(e,e=>{this.unsubscribe(n),t(e)})})}unsubscribe(e){this._subscriptions.delete(e)}sendType(e,t){return e={...e,type:t},console.log("sending=>",e),this.send(e)}transfer(e,t){this._worker.postMessage(e,t)}send(e){return this._worker.postMessage(e)}constructor(e){this._subscriptions=new B,this._worker=e||self,this._worker.addEventListener("message",this._onMessage.bind(this))}}const x={clear:"CLEAR",file:"FILE",error:"ERROR"},C=new TextEncoder,k=new TextDecoder,F=C.encode("<---META-DATA---\x3e"),L=F.buffer,N=L.byteLength,U=C.encode("<---META-DATA---\x3e".split().reverse().join()),I=e=>{const t=(e=String(e)).length;if(t>10)throw new Error("Invalid length");if(10==t)return e;for(;10!==e.length;)e=`0${e}`;return e};class ${static _encodeString(e){return C.encode(e)}static _getMetaDataBuffer(e){return new Promise(t=>{const n="string"==typeof e?C.encode(I(e.length)+e):e;return t($.appendBuffers(n))})}static _getMetaFromBuffer(e){return new Promise(t=>{const n=e.slice(0,10),r=+k.decode(n).replace(/^0+/,"")+10;t({metaData:JSON.parse(k.decode(e.slice(10,r))),encryptedBuffer:e.slice(r)})})}onFile(e,t,n){}constructor(){this.methods={RSA:"RSA-OAEP",AES:"AES-GCM"}}init(){const e=new D(self);this.listener=e,e.subscribeType(x.file,e=>{const{file:t,method:n,key:r}=e;this.onFile(t,n,r)})}static appendBuffers(...e){const t=new Uint8Array(e.reduce((e,t)=>e+t.byteLength,0));let n=0;for(const r of e)t.set(r instanceof Uint8Array?r:new Uint8Array(r),n),n+=r.byteLength;return t.buffer}static arrayBufferToBase64(e){return new Promise((t,n)=>{const r=new Blob([e],{type:"application/octet-stream"}),o=new FileReader;o.onload=e=>{const n=e.target.result;t(n.substr(n.indexOf(",")+1))},o.readAsDataURL(r)})}static async base64ToArrayBuffer(e){const t=await fetch(`data:;base64,${e}`);return await t.arrayBuffer()}static textToChars(e){return e.split("").map(e=>e.charCodeAt(0))}static applySaltToChar(e,t){return $.textToChars(t).reduce((e,t)=>e^t,e)}static enc(e){const t=e=>`0${Number(e).toString(16)}`.substr(-2);return n=>n.split("").map($.textToChars).map(t=>$.applySaltToChar(t,e)).map(t).join("")}static dec(e){return t=>t.match(/.{1,2}/g).map(e=>parseInt(e,16)).map(t=>$.applySaltToChar(t,e)).map(e=>String.fromCharCode(e)).join("")}}a($,{RAW_META_STRING_LENGTH:524288,META_DATA_BOUNDARY:F,META_DATA_BOUNDARY_BUFF:L,META_DATA_LEN:N,META_DATA_BOUNDARY_REVERSE:U});var G="keys"in y?y.keys:function(e){const t=[];for(const n in e)h.call(e,n)&&t.push(n);return t},K="entries"in y?y.entries:function(e){const t=G(e);let n=t.length;const r=Array(n);for(;n--;){const o=t[n];r[n]=[o,e[o]]}return r};const W={};K({clear:"CLEAR",file:"FILE",error:"ERROR"}).map(([e,t])=>W[e]=`ack-${t}`);(new class extends ${_getKeyDict(e,t){return{name:e,iv:t}}async __decrypt(e,t,n){const r=await $._getMetaFromBuffer(e),{iv:o,key:s}=r.metaData,{encryptedBuffer:i}=r,a=await $.base64ToArrayBuffer(o),c=await crypto.subtle.importKey("raw",await $.base64ToArrayBuffer($.dec(n)(s)),t,!0,["encrypt","decrypt"]);return await crypto.subtle.decrypt(this._getKeyDict(t,a),c,i)}async onFile(e,t,n){try{const r=await this.__decrypt(e,t,n);return this.listener.transfer({type:W.file,file:r},[r])}catch(e){return console.log(e),this.listener.sendType({error:!0,message:e.message},W.error)}}}).init()}]);